#include "KeyFrameDisplay.h"

#include <sstream>
#include <fstream>
#include <iostream>
#include "ros/ros.h"
// -----------------------------
// for image
// -----------------------------
#include <sensor_msgs/Image.h>
#include <sensor_msgs/PointCloud.h>
#include <sensor_msgs/PointCloud2.h>
#include <sensor_msgs/point_cloud_conversion.h>

using namespace std; 
using namespace sensor_msgs;

class pc_fetcher{
    public:
	pc_fetcher();
        void _pcCallback(slave_robot::keyframeMsgConstPtr msg);
	void _kfCallback(slave_robot::keyframeGraphMsgConstPtr graph_msg);
	void _imCallback(const ImageConstPtr& image);

	~pc_fetcher();	
	
    private:
	//parameters of the camera
	float _fx, _fy, _cx, _cy, _fxi, _fyi, _cxi, _cyi;
	int _height, _width;
	InputPointDense* _originalInput;
	// camera pose
	// may be updated by kf-graph.
	Sophus::Sim3f _camToWorld;
	// -----------------------------
	// for keyframe 
	// -----------------------------
	static bool _keyframeTrigger;
	// -----------------------------
	// for pub sub
	// -----------------------------
	sensor_msgs::Image _keyframe;
	sensor_msgs::PointCloud _pointcloud;
	sensor_msgs::PointCloud2 _cloud2;
	ros::NodeHandle _slaveRobot;
	ros::Subscriber _pcSub;
	ros::Subscriber _kfSub;
	ros::Subscriber _imSub;
	ros::Publisher _imPub;
	ros::Publisher _pcPub;
};

